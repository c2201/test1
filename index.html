<!DOCTYPE html>
<html>
<head>
    <title>中考倒计时 - C2201|中考必胜</title>
    <meta charset="utf-8">
    <script src="js/solarterms.js"></script>
    <script src="js/timetable.js"></script>
    <script src="js/schedule.js"></script>
    <script src="js/phrases.js"></script>
    


    <style>
        @font-face {
            font-family: 'Ximai';
            src: url('fonts/1.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }

        /* 底部按钮样式 */
        .action-buttons {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            z-index: 10;
        }

        .action-button {
            width: auto;
            padding: 0 20px;
            height: 40px;
            border-radius: 20px;
            background: #8bc34a;
            border: none;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            color: white;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .action-button:hover {
            transform: scale(1.05);
        }

        /* 更新日志样式 */
        .changelog-modal .settings-content {
            max-width: 600px;
            height: 75%;
        }

        .text-content {
            padding: 15px;
            white-space: pre-wrap;
            overflow-y: auto;
            height: calc(100% - 50px);
        }

        /* 设置样式 */
        .settings-button {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #8bc34a;
            border: none;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            transition: transform 0.3s;
        }

        .settings-button:hover {
            transform: translateX(-50%) scale(1.1);
        }

        .settings-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
            z-index: 999;
        }

        .settings-modal.active {
            opacity: 1;
            visibility: visible;
        }

        .settings-content {
            background: white;
            width: 60%;
            height: 75%;
            border-radius: 12px;
            transform: scale(0.8);
            opacity: 0;
            transition: all 0.3s;
            position: relative;
            padding: 20px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .settings-modal.active .settings-content {
            transform: scale(1);
            opacity: 1;
        }

        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        .settings-header h3 {
            margin: 0;
            font-size: 24px;
            color: #333;
        }

        .settings-body {
            display: flex;
            flex-direction: column;
            gap: 10px;
            padding: 20px;
            overflow-y: auto;
            height: calc(100% - 60px);
        }

        /* 模态框关闭按钮样式 */
        .close-btn {
            font-size: 28px;
            cursor: pointer;
            padding: 0 10px;
            color: #666;
        }

        .close-btn:hover {
            color: #333;
        }

        /* 节气卡片样式 */
        .solar-card {
            position: absolute;
            top: calc(100% + 20px);
            left: 50%;
            transform: translateX(-50%);
            width: 500px;
            background: rgba(255,255,255,0.96);
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.15);
            padding: 20px;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, transform 0.3s, visibility 0.3s;
            z-index: 10;
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .solar-card::before {
            content: '';
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 10px solid transparent;
            border-bottom-color: rgba(255,255,255,0.96);
        }

        .solar-card.active {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(0);
        }

        .solar-card h3 {
            text-align: center;
            margin: 0 0 15px;
            font-size: 24px;
            color: #1b5e20;
            font-family: STZhongsong, serif;
        }

        .solar-card img {
            width: 160px;
            height: 140px;
            object-fit: cover;
            border-radius: 8px;
        }

        .solar-card p {
            font-size: 16px;
            line-height: 1.6;
            color: #444;
            margin: 0;
            font-family: 'Microsoft YaHei';
            flex-grow: 1;
            text-align: left;
            text-indent: 2em;
        }

        /.solar-term-marker {
            transition: all 0.3s ease;
        }

        .solar-card {
            transition: opacity 0.3s, transform 0.3s, visibility 0.3s;
        }

        /* 时间容器样式 */
        #currentDateTime {
            position: absolute;
            top: 78px;
            left: 25px;
            z-index: 5;
            background: rgba(255,255,255,0.9);
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            text-align: center;
            min-width: 180px;
        }

        /* 左上角时间样式 */
        .time-section {
            font-family: 'Microsoft-Yahei', sans-serif;
            font-size: 44px;
            letter-spacing: 0;
            color: #1b5e20;
            margin: 8px 0;
            display: block;
                width: 100%;
        }

        /* 左上角日期样式 */
        .date-section {
            font-family: 'Microsoft YaHei', serif;
            font-size: 22px;
            color: #666;
            letter-spacing: 0.5px;
            white-space: nowrap;
            display: block;
            width: 100%;
        }

        /* 金句样式 */
        #goldenPhrase {
            text-align: center;
            margin: 10px auto;
            width: 760px;
            font-size: 26px;
            color: #1b5e20;
            min-height: 40px;
            font-family: STZhongSong, cursive;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
            transition: opacity 0.5s;
            position: relative;
            top: -95px;
            margin-bottom: -45px;
        }

        /* 基础样式 */
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            font-family: 'Microsoft YaHei', sans-serif;
            background: linear-gradient(to bottom right, #f5fff5, #e8f5e9);
        }

        /* 导航栏样式 */
        .navbar {
            background-color: #333;
            overflow: hidden;
            width: 100%;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            position: relative;
            z-index: 6;
        }

        .brand {
            float: left;
            color: white;
            padding: 14px 20px;
            font-size: 20px;
            font-weight: bold;
            text-decoration: none;
            letter-spacing: 1px;
        }

        .navbar a {
            float: left;
            display: block;
            color: #f2f2f2;
            text-align: center;
            padding: 14px 18px;
            text-decoration: none;
            font-size: 16px;
            transition: all 0.3s;
        }

        .navbar a:hover {
            background: #ddd;
            color: black;
        }

        /* 中考倒计时样式 */
        .small-title {
            text-align: center;
            color: #2d2d2d;
            font-size: 38px;
            font-family: STZhongsong, serif;
            margin-top: 50px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }

        .big-title {
            text-align: center;
            color: #1b5e20;
            font-size: 160px;
            font-family: STKaiti;
            margin: 20px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        /* 时间轴样式 */ 
        .timeline-container {
            max-width: 750px;
            margin: 50px auto;
            position: relative;
            height: 120px;
            overflow: visible;
        }

        .timeline-progress {
            height: 8px;
            background: linear-gradient(
                to right,
                #8bc34a 0%,
                #8bc34a var(--progress-percent),
                #e0e0e0 var(--progress-percent),
                #e0e0e0 100%
            );
            border-radius: 4px;
            position: relative;
            margin-top: 60px;
        }

        /* 节气标记样式 */
        .solar-term-marker {
            position: absolute;
            top: -45px;
            width: 70px;
            text-align: center;
            transform: translateX(-50%);
            cursor: pointer;
            transition: all 0.3s;
            z-index: 2;
        }

        .current-marker {
            position: absolute;
            left: 0;
            top: -10px;
            width: 3px;
            height: 30px;
            background: #ff5722;
            transform: translateX(-50%);
            transition: left 0.5s ease-out;
            box-shadow: 0 2px 4px rgba(255,87,34,0.3);
        }

        /* 中考日标记样式 */
        .end-marker {
            position: absolute;
            right: -15px;
            top: -45px;
            width: 90px;
            text-align: center;
            color: #d32f2f;
            font-weight: bold;
            text-shadow: 0 2px 4px rgba(211,47,47,0.2);
            transform: translateX(30%);
        }

        /* 作息提示样式 */
        .schedule-container {
            position: absolute;
            top: 225px;
            left: 25px;
            z-index: 5;
            background: rgba(255,255,255,0.9);
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            min-width: 190px;
        }

        .schedule-item {
            font-family: 'STZhongSong', sans-serif;
            margin: 8px 0;
        }

        .schedule-title {
            display: block;
            font-size: 20px;
            color: #1b5e20;
            font-weight: 600;
            text-align: left;
            line-height: 0.8;
        }

        .schedule-value {
            display: block;
            font-size: 25px;
            color: #2d2d2d;
            text-align: center;
            margin: 4px 0 0;
            padding: 2px 0;
            line-height: 0.8;
        }

        /* 课表样式 */
        .timetable {
            margin-top: 10px;
            border-top: 1px solid #eee;
            padding-top: 8px;
        }

        .timetable-item {
            font-size: 25px;
            font-family: STZhongSong, cursive;
            line-height: 1.2;
            text-align: center;
        }

        /* 每日60s样式 */
        .right-image-container {
            position: fixed;
            right: 25px;
            top: 50%;
            transform: translateY(-50%);
            z-index: 5;
            background: white;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .right-image-container img {
            height: 80vh;
            object-fit: cover;
            display: block;
            margin: 0 auto;
        }

        /* 滑块开关样式 */
        input[type="checkbox"] {
            position: absolute;
            opacity: 0;
            cursor: pointer;
            height: 0;
            width: 0;
        }

        .switch-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 20px;
        }

        .switch {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
        }

        .slider {
            position: relative;
            cursor: pointer;
            width: 40px;
            height: 24px;
            background-color: #ccc;
            transition: 0.4s;
            border-radius: 24px;
        }

        .switch-text {
            font-size: 14px;
            color: #1b5e20;
            display: inline-block;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            transition: 0.4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #8bc34a;
        }

        input:checked + .slider:before {
            transform: translateX(16px);
        }

        input:checked ~ .switch-text {
            color: #4CAF50;
        }

        /* 公告卡片样式 */
        .announcement-card {
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            padding: 20px;
            margin: 15px;
            border: 1px solid #eee;
        }

        .announcement-title {
            font-size: 1.6em;
            color: #1b5e20;
            font-weight: 600;
            margin-bottom: 8px;
            border-bottom: 2px solid #8bc34a;
            padding-bottom: 5px;
            text-align: center;
        }

        .announcement-time {
            font-size: 0.95em;
            color: #666;
            margin-bottom: 15px;
            text-align: center;
        }

        .announcement-body {
            line-height: 1.2;
            color: #444;
            font-size: 1.2em;
        }

        .announcement-body ul {
            margin: 8px 0;
            padding-left: 25px;
        }

        .announcement-body li {
            margin: 6px 0;
        }

        .announcement-footnote {
            font-size: 0.85em;
            color: #999;
            margin-top: 15px;
            border-top: 1px dashed #ddd;
            padding-top: 10px;
        }

        .announcement-content {
            height: calc(100% - 60px);
            overflow-y: auto;
            padding: 0 10px;
        }

        .announcement-content::-webkit-scrollbar {
            width: 6px;
        }

        .announcement-content::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }

        .announcement-content::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 3px;
        }

        .announcement-content::-webkit-scrollbar-thumb:hover {
            background: #8bc34a;
        }

        /* 概率控制样式 */
        .probability-control {
            display: flex;
            align-items: center;
            gap: 15px;
            width: 100%;
            margin: 12px 0;
        }

        .probability-control .switch-text {
            flex: 1;
            font-size: 14px;
            color: #1b5e20;
        }

        .range-group {
            display: flex;
            align-items: center;
            gap: 10px;
            width: 40%;
            justify-content: flex-end;
        }

        #apiProbability {
            width: 100%;
            height: 4px;
            background: #ddd;
            border-radius: 2px;
            -webkit-appearance: none;
            margin: 0 8px;
        }

        #apiProbability::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            background: #8bc34a;
            border-radius: 50%;
            cursor: pointer;
            border: none;
            box-shadow: none;
        }

        #apiProbability::-moz-range-thumb {
            width: 16px;
            height: 16px;
            background: #8bc34a;
            border-radius: 50%;
            border: none;
            cursor: pointer;
        }

        #apiProbabilityValue {
            width: 50px;
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: center;
            font-size: 13px;
        }

        /* 间隔时间控制样式 */
        #intervalSlider {
            width: 100%;
            height: 4px;
            background: #ddd;
            border-radius: 2px;
            -webkit-appearance: none;
            margin: 0 8px;
        }

        #intervalSlider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            background: #8bc34a;
            border-radius: 50%;
            cursor: pointer;
            border: none;
            box-shadow: none;
        }

        #intervalSlider::-moz-range-thumb {
            width: 16px;
            height: 16px;
            background: #8bc34a;
            border-radius: 50%;
            border: none;
            cursor: pointer;
        }

        #intervalValue {
            width: 50px;
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: center;
            font-size: 13px;
        }

        /* 重置按钮样式 */
        .reset-btn {
            padding: 5px 12px;
            min-width: 50px;
            white-space: nowrap;
            background: #8bc34a;
            border-radius: 4px;
            color: white;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
        }

        .reset-btn:hover {
            background: #7cb342;
            transform: scale(1.05);
            box-shadow: none;
        }

        /* 金句点击效果 */
        #goldenPhrase {
            cursor: pointer;
            transition: all 0.3s;
        }

        #goldenPhrase:active {
            transform: scale(0.98);
        }

        /* 动画控制样式 */
        #goldenPhrase.no-animation {
            transition: none !important;
        }

        #goldenPhrase.no-animation:active {
            transform: none !important;
        }

        /* 金句列表样式 */
        #phraseList {
            padding: 15px;
            overflow-y: auto;
            height: calc(100% - 50px);
        }

        .phrase-item {
            padding: 12px;
            margin: 8px 0;
            border-radius: 6px;
            background: #f8f8f8;
            cursor: pointer;
            transition: all 0.2s;
            font-family: STZhongSong, cursive;
            color: #1b5e20;
        }

        .phrase-item:hover {
            background: #e8f5e9;
            transform: translateX(5px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        /* 选择金句界面金句点击动画 */
        .phrase-item {
            transition: all 0.3s ease;
        }

        .phrase-item:active {
            transform: scale(0.97);
            background: #e0f2f1 !important;
        }

        @keyframes phraseClickWave {
            0% { box-shadow: 0 0 0 0 rgba(139, 195, 74, 0.3); }
            100% { box-shadow: 0 0 0 10px rgba(139, 195, 74, 0); }
        }

        .phrase-click-effect {
            animation: phraseClickWave 0.4s ease-out;
            position: relative;
        }

        /* 寻物板 */
        .editable {
            cursor: pointer;
            transition: all 0.3s;
            padding: 2px 5px;
            border-radius: 4px;
            font-family: STZhongsong, serif;
            color: #1E90FF;
            text-shadow: 0 0 2px rgba(0,0,0,0.2);
            border-bottom: 2px solid #FFD700; /* 金色下划线 */
        }

        .editable:hover {
            background: #f0f0f0;
        }

        .edit-input {
            width: 120px;
            padding: 5px;
            border: 2px solid #8bc34a;
            border-radius: 4px;
            font-size: 28px;
            text-align: center;
            color: #1E90FF;
            margin: 0 5px;
            font-family: STZhongsong, serif;
        }

        @keyframes gradient-pulse {
            0% {background-position: 0% 50%;}
            50% {background-position: 100% 50%;}
            100% {background-position: 0% 50%;}
        }

        .add-button {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #8bc34a, #7cb342);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            /* 添加阴影效果 */
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25), 
                        0 0 0 2px rgba(255, 255, 255, 0.8) inset;
            transition: all 0.3s ease;
            z-index: 999;
            font-size: 24px;
            font-weight: bold;
            animation: button-pulse 2s infinite;
        }

        /* 悬停效果 - 放大和增强阴影 */
        .add-button:hover {
            transform: scale(1.15);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3),
                        0 0 0 2px rgba(255, 255, 255, 0.9) inset;
        }

        /* 点击动画 - 缩小效果 */
        .add-button:active {
            transform: scale(0.85);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2),
                        0 0 0 3px rgba(255, 255, 255, 0.8) inset;
            background: linear-gradient(135deg, #7cb342, #689f38);
        }

        /* 添加按钮的发光动画 */
        @keyframes button-pulse {
            0% { box-shadow: 0 0 0 0 rgba(139, 195, 74, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(139, 195, 74, 0); }
            100% { box-shadow: 0 0 0 0 rgba(139, 195, 74, 0); }
        }

        .delete-btn {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            padding: 4px 12px;
            border-radius: 15px;
            background: #ff4444;
            color: white;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
        }

        #lostAndFoundList .announcement-card {
            padding: 12px;
            margin: 8px 10px;
        }

        #lostAndFoundList .announcement-body {
            line-height: 1.1;
        }

        #lostAndFoundList .editable {
            margin: 1px 0;
            padding: 2px 4px;
        }

        /* 通知样式 */
        .notification-container {
            display: flex;
            flex-direction: column;
            height: 100%;
            font-family: STZhongsong, serif;
        }
        
        #notificationContent {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            transition: font-size 0.3s ease;
            max-height: calc(100% - 70px);
        }
        
        .notification-item {
            position: relative;
            margin-bottom: 15px;
            padding: 15px;
            background: #f8f8f8;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            min-height: 40px;
            word-wrap: break-word;
            overflow-wrap: break-word;
            font-family: inherit;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .notification-item:hover {
            background: #e8f5e9;
            box-shadow: 0 3px 8px rgba(0,0,0,0.1);
        }
        
        .notification-editable {
            width: 100%;
            min-height: 60px;
            padding: 10px;
            border: 2px solid #8bc34a;
            border-radius: 4px;
            font-size: inherit;
            box-sizing: border-box;
            font-family: inherit;
            resize: vertical;
            line-height: 1.5;
        }
        
        .notification-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-top: 1px solid #eee;
            margin-top: 10px;
            position: sticky;
            bottom: 0;
            background: white;
            z-index: 10;
            flex-shrink: 0;
        }
        
        .font-size-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .font-size-label {
            font-size: 14px;
            color: #1b5e20;
            font-family: STZhongsong, serif;
        }
        
        #fontSizeSlider {
            width: 150px;
            height: 4px;
            background: #ddd;
            border-radius: 2px;
            -webkit-appearance: none;
        }
        
        #fontSizeSlider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            background: #8bc34a;
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }
        
        #fontSizeSlider::-moz-range-thumb {
            width: 16px;
            height: 16px;
            background: #8bc34a;
            border-radius: 50%;
            border: none;
            cursor: pointer;
        }
        
        #fontSizeValue {
            width: 50px;
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: center;
            font-size: 13px;
            font-family: inherit;
        }
        
        .add-notification-btn {
            padding: 8px 15px;
            background: #8bc34a;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
            font-family: STZhongsong, serif;
            font-size: 15px;
        }
        
        .add-notification-btn:hover {
            background: #7cb342;
            transform: scale(1.05);
        }
        
        .delete-notification-btn {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            padding: 4px 12px;
            border-radius: 15px;
            background: #ff4444;
            color: white;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
            font-family: STZhongsong, serif;
            font-size: 14px;
        }
        
        .empty-notification {
            text-align: center;
            padding: 30px;
            color: #999;
            font-style: italic;
        }

        /* 最大化按钮样式 */
        .maximize-btn {
            cursor: pointer;
            font-size: 24px;
            padding: 0 10px;
            color: #666;
            transition: all 0.3s;
            position: relative;
            z-index: 100;
        }

        .maximize-btn:hover {
            color: #333;
            transform: scale(1.1);
        }

        /* 全屏模态框样式 */
        .settings-modal.fullscreen .settings-content {
            width: 100%;
            height: 100%;
            max-width: none;
            max-height: none;
            border-radius: 0;
        }

        /* 平滑过渡动画 */
        .settings-content {
            transition: all 0.3s ease;
        }

        /* 统一的滑动条样式 */
        #fontSizeSlider, #lostAndFoundFontSizeSlider {
            width: 150px;
            height: 4px;
            background: #ddd;
            border-radius: 2px;
            -webkit-appearance: none;
            margin: 0 8px;
        }
        
        #fontSizeSlider::-webkit-slider-thumb, 
        #lostAndFoundFontSizeSlider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            background: #8bc34a;
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }
        
        #fontSizeSlider::-moz-range-thumb, 
        #lostAndFoundFontSizeSlider::-moz-range-thumb {
            width: 16px;
            height: 16px;
            background: #8bc34a;
            border-radius: 50%;
            border: none;
            cursor: pointer;
        }
    </style>



</head>
<body>
    <!-- 导航栏 -->
    <header>
        <nav class="navbar">
            <div class="brand">C2201</div>
            <a href="https://c2201.github.io/">首页</a>
            <a href="https://c2201.github.io/countdown/">新&nbsp;·&nbsp;二十四节气中考倒计时</a>
            <!-- <a href="https://c2201.github.io/wheel/">转盘</a> -->
        </nav>
    </header>
 
    <!-- 时钟 -->
    <div id="currentDateTime">
        <div class="time-section"></div>
        <div class="date-section"></div>
    </div>

    <!-- 作息提示容器 -->
    <div id="scheduleContainer" class="schedule-container">
        <div class="schedule-item">
            <span class="schedule-title">天气：</span>
            <span class="schedule-value" id="weatherInfo">加载中...</span>
        </div>
        <div class="schedule-item">
            <span class="schedule-title">当前：</span>
            <span class="schedule-value" id="currentSchedule">加载中...</span>
        </div>
        <div class="schedule-item">
            <span class="schedule-title">下节课：</span>
            <span class="schedule-value" id="nextSchedule">加载中...</span>
        </div>
        <div class="schedule-item">
            <span class="schedule-title" id="countdownName">倒计时：</span>
            <span class="schedule-value" id="countdownTimer" style="font-size: 28px;">--:--</span>
        </div>
        <div class="timetable" id="todayTimetable"></div>
    </div>
 
    <!-- 中考倒计时 -->
    <div class="small-title">距离2025年中考仅剩</div>
    <div id="daysUntil" class="big-title"></div>
 
    <!-- 时间轴 -->
    <div class="timeline-container">
        <div class="timeline-progress" id="timeline">
            <div class="end-marker">
                <div style="white-space: nowrap;">中考日</div>
                <div style="font-size:0.9em; margin-top:3px">6月18日</div>
            </div>
        </div>
    </div>
 
    <!-- 金句 -->
    <div id="goldenPhrase"></div>

    <!-- 每日60s -->
    <div class="right-image-container">
        <img id="apiImage" src="" alt="每日60s">
    </div>

    <!-- 底部按钮 -->
    <div class="action-buttons">
        <button id="settingsButton" class="action-button">⚙️ 设置</button>
        <button id="changelogButton" class="action-button">📝 更新日志</button>
        <button id="announcementButton" class="action-button">📢 公告</button>
        <button id="phraseSelectButton" class="action-button">📜 选择金句</button>
        <button id="lostAndFoundButton" class="action-button">🔍 寻物</button>
        <button id="notificationButton" class="action-button">🔔 通知</button>
    </div>

    <!-- 设置模态框 -->
    <div class="settings-modal" id="settingsModal">
        <div class="settings-content">
            <div class="settings-header">
                <h3>设置</h3>
                <span class="close-btn" id="closeSettings">&times;</span>
            </div>
            <div class="settings-body">
                <div class="switch-container">
                    <label class="switch">
                        <span class="switch-text">金句自动轮播</span>
                        <input type="checkbox" id="goldenSwitch" checked>
                        <span class="slider"></span>
                    </label>
                    <label class="switch">
                        <span class="switch-text">显示每日60s</span>
                        <input type="checkbox" id="imageSwitch">
                        <span class="slider"></span>
                    </label>
                    <div class="probability-control">
                        <span class="switch-text">联网获取金句的概率(%)</span>
                        <div class="range-group">
                            <input type="range" id="apiProbability" min="0" max="100" value="50">
                            <input type="number" id="apiProbabilityValue" min="0" max="100" value="50">
                            <button class="reset-btn" onclick="resetProbability()">重置</button>
                        </div>
                    </div>
                    <div class="probability-control">
                        <span class="switch-text">金句轮播时间间隔（秒）</span>
                        <div class="range-group">
                            <input type="range" id="intervalSlider" min="1" max="60" value="15">
                            <input type="number" id="intervalValue" min="1" max="60" value="15">
                            <button class="reset-btn" onclick="resetInterval()">重置</button>
                        </div>
                    </div>
                    <label class="switch">
                        <span class="switch-text">启用点击刷新金句</span>
                        <input type="checkbox" id="clickRefreshSwitch">
                        <span class="slider"></span>
                    </label>
                    <label class="switch">
                        <span class="switch-text">开启金句动画效果</span>
                        <input type="checkbox" id="animationSwitch" checked>
                        <span class="slider"></span>
                    </label>
                    <label class="switch">
                        <span class="switch-text">本地金句只展示原创</span>
                        <input type="checkbox" id="originalSwitch">
                        <span class="slider"></span>
                    </label>
                    <label class="switch">
                        <span class="switch-text">自动刷新页面</span>
                        <input type="checkbox" id="autoRefreshSwitch" checked>
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
        </div>
    </div>

    <!-- 更新日志模态框 -->
    <div class="settings-modal" id="changelogModal">
        <div class="settings-content">
            <div class="settings-header">
                <h3>更新日志</h3>
                <span class="close-btn" id="closeChangelog">&times;</span>
            </div>
            <div class="text-content" id="changelogContent">
                <strong># 20250607.1 更新</strong>

                • 增加每隔15min自动刷新页面功能
                • 缩小设置界面设置项间距

                <strong># 20250531.4 更新</strong>

                • 美化寻物板添加按钮

                <strong># 20250531.3 更新</strong>

                • 寻物板支持调整字体大小

                <strong># 20250531.2 更新</strong>

                • 通知板开发完毕
                • 添加模态框全屏功能（仅限寻物、通知板）
                • 将寻物板的“寻物”大字标题下移12px

                <strong># 20250531.1 更新</strong>

                • 金句支持换行
                • 选择金句后立刻关闭模态框
                • 通知功能（开发中，暂不可见）

                <strong># 20250524.4 更新</strong>

                • 恢复导航栏的悬停效果

                <strong># 20250524.3 更新</strong>

                • 更改部分金句的权重

                <strong># 20250524.2 更新</strong>

                • 在选择金句后重置定时器

                <strong># 20250524.1 更新</strong>

                • 新增“本地金句只展示原创”功能
                • 设置界面支持滚动

                <strong># 20250504.2 更新</strong>

                • 新增下课（下考/下晚自习等）倒计时

                <strong># 20250504.1 更新</strong>

                • 考虑到周五英语考试只有100分钟，将工作日作息表拆分为周一到周四、周五两个部分，进行特殊处理

                <strong># 20250502.4 更新</strong>

                功能性更新：
                    • 为金句新增4个API：2个古诗词API、1个唯美语句API、1个名句API，并添加权重
                    • 将金句显示区域上移45px
                    • 更改《飞鸟集》语句API的显示格式为“英文（中文）——泰戈尔”
                技术性更新：
                    • 又将20250502.1更新中更改的“将css和js代码放入了单独的文件中”改了回来，再次全部塞进index.html

                <strong># 20250502.3 更新</strong>

                • 修复了若干修改课程表、作息表后导致的bug

                <strong># 20250502.2 更新</strong>

                • 修改了部分金句的展示概率

                <strong># 20250502.1 更新</strong>

                功能性更新：
                    • 修改了课程表和作息表
                    • 将寻物板中的名字和物品改为蓝色，并将字号调大为28px（原24px），且在下方添加金色下划线
                技术性更新：
                    • 修改了获取、展示课程表、作息表相关逻辑
                    • 将css和js代码放入了单独的文件中

                <strong># 20250426.1 更新</strong>

                • 新增“寻物”功能

                <strong># 20250322.2 更新</strong>

                • 新增“金句选择”功能

                <strong># 20250322.1 更新</strong>

                • 新增“开启金句动画效果”开关

                <strong># 20250315.1 更新</strong>

                功能性更新：
                    • 新增点击刷新金句功能
                    • 新增“启用点击刷新金句”开关
                技术性更新：
                    • 将index.html中JavaScript部分的“Part0 各种数据”拆分为单独的js文件

                <strong># 20250309.1 更新</strong>

                功能性更新：
                    • 调大金句和左侧作息显示、课程表的字体
                技术性更新：
                    • 更新日志内容不再从文件读取，而是直接添加在index.html中

                <strong># 20250301.3 更新</strong>
                
                • 修复已知问题，提升系统稳定性
                
                <strong># 20250301.2 更新</strong>
                
                功能性更新：
                    • 新增"金句轮播时间间隔"设置
                    • 新增"联网获取金句的概率"设置
                    • 给金句添加了出处显示
                    • 将所有本地金句库中的金句分为3个等级，分别对应不同的展示概率
                技术性更新：
                    • 公告板内容不再从文件读取，而是直接添加在index.html中
                
                <strong># 20250301.1 更新</strong>
                
                • 更新了公告板
                
                <strong># 20250224.2 更新</strong>
                
                • 更新了更新日志
                
                <strong># 20250224.1 更新</strong>
                
                • 更新了设置中心
            </div>
        </div>
    </div>

    <!-- 公告板模态框 -->
    <div class="settings-modal" id="announcementModal">
        <div class="settings-content">
            <div class="settings-header" style="padding-bottom: 8px;">
                <h3 style="font-size: 1.2em;">公告</h3>
                <span class="close-btn" id="closeAnnouncement">&times;</span>
            </div>
            <div class="announcement-content">
                <div class="announcement-card">
                    <div class="announcement-title">📢 倒计时网站征稿活动开始啦！</div>
                    <div class="announcement-time">2025.3.1</div>
                    <div class="announcement-body">
                        C2201倒计时网站底部金句轮播内容<strong>开始征稿了</strong>！选上的作品可以放在网站上<strong>轮播展示</strong>！
                        <ul>
                            <li><strong>参与条件：</strong>是个人都能参加</li>
                            <li><strong>时间：</strong>即日起至2025年5月31日（活动已结束）</li>
                            <li><strong>征稿内容：</strong><strong>励志文字</strong>、优美<strong>作文素材</strong>、<strong>诗歌（含现代诗）</strong>或<strong>整活</strong>（<strong>不能八卦</strong>）等（特别地，既可以原创，也可以投你在其他地方看到的很好的句子上来，但是要<strong>标明出处</strong>；若是原创句子可选择展示时是否显示署名）（一个句子展示的概率：励志文字 = 优美作文素材 > 整活，可根据具体情况调整，特别地，若原创句子写的<strong>过于精妙</strong>，可以<strong>提高展示概率</strong>）</li>
                            <li><strong>字数要求：</strong>1~80字（包含标点）</li>
                            <li><strong>提交格式：</strong>你的名字+句子内容+是否原创（+若非原创，标明出处）</li>
                            <li><strong>提交方式：</strong>写在便利贴上交给TQC</li>
                        </ul>
                        <p class="announcement-footnote">最终解释权归TQC所有</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 金句选择模态框 -->
    <div class="settings-modal" id="phraseModal">
        <div class="settings-content">
            <div class="settings-header">
                <h3>选择金句</h3>
                <span class="close-btn" id="closePhrase">&times;</span>
            </div>
            <div class="text-content" id="phraseList"></div>
        </div>
    </div>

    <!-- 寻物模态框 -->
    <div class="settings-modal" id="lostAndFoundModal">
        <div class="settings-content">
            <div class="settings-header">
                <h3>寻物</h3>
                <div style="display: flex; align-items: center;">
                    <span class="maximize-btn" id="maximizeLostAndFound">⛶</span>
                    <span class="close-btn" id="closeLostAndFound">&times;</span>
                </div>
            </div>
            <div class="notification-container" style="display: flex; flex-direction: column; height: 100%;">
                <div class="big-title" style="
                    background: linear-gradient(135deg, #FF0000 0%, #FF6B00 25%, #FFD700 50%, #FF6B00 75%, #FF0000 100%);
                    -webkit-background-clip: text;
                    background-clip: text;
                    -webkit-text-fill-color: transparent;
                    background-size: 200% 200%;
                    animation: gradient-pulse 4s ease infinite;
                    text-shadow: 2px 2px 4px rgba(0,0,0,0.3), 0 0 10px rgba(255,107,0,0.5);
                    font-size: 120px;
                    font-family: STXingkai, cursive;
                    letter-spacing: 4px;
                    width: 100%;
                    text-align: center;
                    margin: -8px 0 0;
                    padding: 0;
                    line-height: 1.2;
                ">寻物</div>
                
                <div class="announcement-content" id="lostAndFoundList" style="flex: 1; overflow-y: auto; padding: 10px;">
                    <div class="add-button">+</div>
                </div>
                
                <div class="notification-footer" style="position: sticky; bottom: 0; background: white; z-index: 10; padding: 10px 15px; border-top: 1px solid #eee;">
                    <div class="font-size-control">
                        <span class="font-size-label">字体大小:</span>
                        <input type="range" id="lostAndFoundFontSizeSlider" min="12" max="120" value="28">
                        <input type="number" id="lostAndFoundFontSizeValue" min="12" max="120" value="28">
                        <span>px</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 通知模态框 -->
    <div class="settings-modal" id="notificationModal">
        <div class="settings-content">
            <div class="settings-header">
                <h3>通知</h3>
                <div style="display: flex; align-items: center;">
                    <span class="maximize-btn" id="maximizeNotification">⛶</span>
                    <span class="close-btn" id="closeNotification">&times;</span>
                </div>
            </div>
            <div class="notification-container">
                <div id="notificationContent">
                    <div class="empty-notification">暂无通知，点击下方按钮添加</div>
                </div>
                <div class="notification-footer">
                    <button class="add-notification-btn" id="addNotificationBtn">+ 添加通知</button>
                    <div class="font-size-control">
                        <span class="font-size-label">字体大小:</span>
                        <input type="range" id="fontSizeSlider" min="12" max="120" value="16">
                        <input type="number" id="fontSizeValue" min="12" max="120" value="16">
                        <span>px</span>
                    </div>
                </div>
            </div>
        </div>
    </div>



    <script>
        // Part1 时间间隔设置
        let intervalDuration = 15 * 1000;
        let phraseTimer = null;

        // 滑动条和输入框事件
        document.getElementById('intervalSlider').addEventListener('input', function(e) {
            const value = Math.min(120, Math.max(1, parseInt(e.target.value) || 15));
            intervalDuration = value * 1000;
            document.getElementById('intervalValue').value = value;
            // 如果自动轮播开启则立即应用新间隔
            if (goldenSwitch.checked && phraseTimer) {
                clearInterval(phraseTimer);
                phraseTimer = setInterval(fetchGoldenPhrase, intervalDuration);
            }
        });

        document.getElementById('intervalValue').addEventListener('input', function(e) {
            const value = Math.min(120, Math.max(1, parseInt(e.target.value) || 15));
            intervalDuration = value * 1000;
            document.getElementById('intervalSlider').value = value;
        });

        // 重置间隔
        function resetInterval() {
            intervalDuration = 15 * 1000;
            document.getElementById('intervalSlider').value = 15;
            document.getElementById('intervalValue').value = 15;
            
            if (goldenSwitch.checked && phraseTimer) {
                clearInterval(phraseTimer);
                phraseTimer = setInterval(fetchGoldenPhrase, intervalDuration);
            }
        }

        // Part2 概率控制
        let apiProbability = 50;

        // 滑动条输入事件监听
        document.getElementById('apiProbability').addEventListener('input', function(e) {
            const value = Math.min(100, Math.max(0, parseInt(e.target.value) || 0));
            apiProbability = value;
            document.getElementById('apiProbabilityValue').value = value;
        });

        // 数值输入框事件监听
        document.getElementById('apiProbabilityValue').addEventListener('input', function(e) {
            const value = Math.min(100, Math.max(0, parseInt(e.target.value) || 0));
            apiProbability = value;
            document.getElementById('apiProbability').value = value;
        });

        // 重置按钮
        function resetProbability() {
            apiProbability = 50;
            document.getElementById('apiProbability').value = 50;
            document.getElementById('apiProbabilityValue').value = 50;
        }

        // Part3 公告板
        const announcementButton = document.getElementById('announcementButton');
        const announcementModal = document.getElementById('announcementModal');
        const closeAnnouncement = document.getElementById('closeAnnouncement');

        // 打开公告
        announcementButton.addEventListener('click', () => {
            announcementModal.classList.add('active');
        });

        // 关闭公告
        closeAnnouncement.addEventListener('click', () => {
            announcementModal.classList.remove('active');
        });

        // Part4 更新日志功能
        const changelogButton = document.getElementById('changelogButton');
        const changelogModal = document.getElementById('changelogModal');
        const closeChangelog = document.getElementById('closeChangelog');

        // 打开更新日志
        changelogButton.addEventListener('click', () => {
            changelogModal.classList.add('active');
        });

        // 关闭更新日志
        closeChangelog.addEventListener('click', () => {
            changelogModal.classList.remove('active');
        });

        // Part5 设置
        const settingsButton = document.getElementById('settingsButton');
        const settingsModal = document.getElementById('settingsModal');
        const closeButton = document.getElementById('closeSettings');

        // 打开设置
        settingsButton.addEventListener('click', () => {
            settingsModal.classList.add('active');
        });

        // 关闭设置
        closeButton.addEventListener('click', () => {
            settingsModal.classList.remove('active');
        });

        // Part6 作息显示功能
        // 时间转换函数
        function timeToMinutes(time) {
            if (time instanceof Date) {
                return time.getHours() * 60 + time.getMinutes();
            }
            if(time === "23:59") return 1439;
            const [h, m] = time.split(':').map(Number);
            return h * 60 + m;
        }

        // 获取当前作息
        function getCurrentSchedule() {
            const now = new Date();
            const day = now.getDay();
            const currentMinutes = now.getHours() * 60 + now.getMinutes();
            // 如果是周末
            if(day === 0 || day === 6) return {current: "周末", nextLesson: ""};
            const todaySchedule = (day === 5) ? schedule.friday : schedule.weekday;
            let current = "";
            let nextLesson = "";
            // 处理跨天时段（22:20-7:00）
            if(currentMinutes >= timeToMinutes("22:20") || currentMinutes < timeToMinutes("7:00")) {
                current = "洗漱睡觉";
                nextLesson = "无";  // 明确设置为"无"
                return {current, nextLesson};  // 直接返回，不查找下节课
            }
            // 查找当前时间段
            let currentIndex = -1;
            for(let i = 0; i < todaySchedule.length; i++) {
                const [start, end] = todaySchedule[i][0].split('-');
                const startTime = timeToMinutes(start);
                const endTime = timeToMinutes(end);
                if(currentMinutes >= startTime && currentMinutes < endTime) {
                    current = todaySchedule[i][1];
                    currentIndex = i;
                    break;
                }
            }
            // 查找下一个"节课"
            if(currentIndex >= 0) {
                for(let i = currentIndex + 1; i < todaySchedule.length; i++) {
                    if(todaySchedule[i][1].endsWith("节课") || todaySchedule[i][1].endsWith("考试")) {
                        nextLesson = todaySchedule[i][1];
                        break;
                    }
                }
                // 如果没有找到下节课，则设置为"无"
                if(!nextLesson) {
                    nextLesson = "无";
                }
            }
            return {current, nextLesson};
        }

        // 获取课程名称
        function getCourseName(day, lessonIndex) {
            const days = ["sunday", "monday", "tuesday", "wednesday", "thursday", "friday", "saturday"];
            const timetableDay = timetable[days[day]];
            return timetableDay ? timetableDay[lessonIndex] : "";
        }

        // 更新作息显示
        function updateScheduleDisplay() {
            const now = new Date();
            const day = now.getDay();  
            const {current, nextLesson} = getCurrentSchedule();
            
            // 当前作息
            let currentText = current;
            if(current.includes(" 课")) {
                const lessonItems = schedule.weekday.filter(item => 
                    item[1].endsWith("节课") || item[1].endsWith("考试"));
                const currentLessonIndex = lessonItems.findIndex(item => item[1] === current);
                if(currentLessonIndex >=0 && currentLessonIndex <9) {
                    currentText = getCourseName(day, currentLessonIndex);
                }
            }
            document.getElementById('currentSchedule').textContent = currentText;
            
            // 下节课
            let nextText = nextLesson;
            if(nextLesson) {
                const lessonItems = schedule.weekday.filter(item => 
                    item[1].endsWith("节课") || item[1].endsWith("考试"));
                const nextLessonIndex = lessonItems.findIndex(item => item[1] === nextLesson);
                if(nextLessonIndex >=0 && nextLessonIndex <9) {
                    nextText = getCourseName(day, nextLessonIndex);
                }
            }
            document.getElementById('nextSchedule').textContent = nextText || "无";
            
            // 课表
            if(day >=1 && day <=5) {
                const courses = timetable[Object.keys(timetable)[day-1]];
                document.getElementById('todayTimetable').innerHTML = courses.map((c,i) => 
                    `<div class="timetable-item">${i+1}&nbsp;${c}</div>`
                ).join('');
            } else {
                document.getElementById('todayTimetable').innerHTML = 
                    '<div class="timetable-item">周末无课表</div>';
            }
        }

        // Part6.1 作息倒计时功能
        function getNextScheduleInfo() {
            const now = new Date();
            const day = now.getDay();
            const currentMinutes = now.getHours() * 60 + now.getMinutes();
            const todaySchedule = (day === 5) ? schedule.friday : schedule.weekday;
            const { current } = getCurrentSchedule();

            if (current === "放学" || day === 0 || day === 6) {
                return getNextSchoolDayTime(now);
            }

            if (current === "午休") {
                const inFirstPart = currentMinutes < timeToMinutes("13:10");
                return {
                    endTime: inFirstPart ? "13:10" : "13:40",
                    label: inFirstPart ? "熄灯" : "起床"
                };
            }

            let currentIndex = todaySchedule.findIndex(([timeRange]) => {
                const [start, end] = timeRange.split('-');
                return currentMinutes >= timeToMinutes(start) && 
                       currentMinutes < timeToMinutes(end);
            });

            if (current === "课间") {
                const currentRange = todaySchedule[currentIndex][0];
                if (currentRange === "13:50-14:00") return { endTime: "14:00", label: "课前唱结束" };
                if (currentRange === "15:30-15:40") return { endTime: "15:40", label: "考前准备" };
                return { 
                    endTime: todaySchedule[currentIndex][0].split('-')[1], 
                    label: "上课" 
                };
            }

            const labelMap = {
                "早餐": "早读开始",
                "早读": "早读结束",
                "午餐": "午休静校",
                "政史背记": "晚自习开始",
                "考前准备": "考试开始",
                "考试": "考试结束",
                "晚餐": "政史背记开始",
                "洗漱睡觉": "起床"
            };

            if (current.includes("节课")) {
                const nextEvent = todaySchedule[currentIndex + 1]?.[1] || "";
                return {
                    endTime: todaySchedule[currentIndex][0].split('-')[1],
                    label: nextEvent.includes("课间") ? "下课" : "休息"
                };
            }

            const nextIndex = currentIndex + 1;
            if (nextIndex < todaySchedule.length) {
                return {
                    endTime: todaySchedule[nextIndex][0].split('-')[0],
                    label: labelMap[current] || todaySchedule[nextIndex][1]
                };
            }

            return { endTime: "23:59", label: "新的一天" };
        }

        function getNextSchoolDayTime(now) {
            const target = new Date(now);
            let daysUntilMonday = (1 + 7 - target.getDay()) % 7; 
            if (target.getDay() === 1 && target.getHours() < 7) daysUntilMonday = 0;
            target.setDate(target.getDate() + daysUntilMonday);
            target.setHours(7, 0, 0, 0);
            return { endTime: target, label: "周一返校" };
        }

        function updateCountdownDisplay() {
            const result = getNextScheduleInfo();
            const now = new Date();
            let target, label;

            if (result.endTime instanceof Date) {
                target = result.endTime;
                label = result.label;
            } else {
                label = result.label;
                const [endHour, endMinute] = result.endTime.split(':').map(Number);
                target = new Date(now);
                target.setHours(endHour, endMinute, 0, 0);
                if (target < now) target.setDate(target.getDate() + 1);
            }

            let diff = target - now;
            if (diff < 0) diff = 0;
            
            const seconds = Math.floor(diff / 1000);
            const h = Math.floor(seconds / 3600);
            const m = Math.floor((seconds % 3600) / 60);
            const s = seconds % 60;

            // 关键修改点：使用正确的ID选择器
            const timerElement = document.getElementById('countdownTimer');
            const labelElement = document.getElementById('countdownName');

            // 更新显示格式
            labelElement.textContent = `距离${label}还有：`;
            
            if (h > 0) {
                timerElement.textContent = 
                    `${h.toString().padStart(2, '0')}:` +
                    `${m.toString().padStart(2, '0')}:` +
                    `${s.toString().padStart(2, '0')}`;
            } else {
                timerElement.textContent = 
                    `${m.toString().padStart(2, '0')}:` +
                    `${s.toString().padStart(2, '0')}`;
            }

            setTimeout(updateCountdownDisplay, 1000);

            // 周一返校强制刷新逻辑
            if (diff <= 0 && label === "周一返校") {
                setTimeout(() => {
                    location.reload();
                }, 1000);
            }
        }

        // Part7 金句功能
        const apiConfigs = [
            {
                url: 'https://zj.v.api.aa1.cn/api/wenan-shici/?type=json',
                method: 'GET',
                weight: 15,
                maxRetry: 3, // 最大重试次数
                handler: (data) => {
                    const text = data.msg || '';
                    return text.length <= 100 ? text : null;
                }
            },
            {
                url: 'https://api.songzixian.com/api/daily-poem?dataSource=LOCAL_DAILY_POEM',
                method: 'GET',
                weight: 15,
                maxRetry: 3,
                handler: (data) => {
                    if (!data.data) return null;
                    
                    // 处理标题格式
                    let title = data.data.title;
                    // 去除标题中的空格点号
                    title = title.replace(/\s*·\s*/g, '·');
                    // 判断是否需要添加书名号
                    const hasBookMarks = /^《(.+)》$/.test(title);
                    const formattedTitle = hasBookMarks ? title : `《${title}》`;
                    
                    return `${data.data.quotes}——${data.data.author}${formattedTitle}`;
                }
            },
            {
                url: 'https://zj.v.api.aa1.cn/api/wenan-wm/?type=json',
                method: 'GET',
                weight: 20,
                maxRetry: 3,
                handler: (data) => {
                    const text = data.msg || '';
                    return text.length <= 100 ? text : null;
                }
            },
            {
                url: 'https://zj.v.api.aa1.cn/api/wenan-mj/?type=json',
                method: 'GET',
                weight: 30,
                maxRetry: 3,
                handler: (data) => {
                    const text = data.msg || '';
                    return text.length <= 100 ? text : null;
                }
            },
            {
                url: 'https://api.mu-jie.cc/stray-birds/range?type=json',
                method: 'GET',
                weight: 20,
                maxRetry: 5,
                handler: (data) => {
                    const chLength = data.cn?.length || 0;
                    const enLength = data.en?.length || 0;
                    // 中文超长直接返回null触发重试
                    if (chLength > 100) return null;
                    // 计算总长度：英文按0.5倍计算
                    const totalLength = (enLength * 0.5) + chLength;
                    if (totalLength <= 100) {
                        return `${data.en}（${data.cn}）——泰戈尔`;
                    }
                    // 仅显示中文
                    return `${data.cn}——泰戈尔`;
                }
            }
        ];

        let currentApiIndex = 0;

        async function fetchWithRetry(apiConfig, retryCount = 0) {
            try {
                const response = await fetch(apiConfig.url, { method: apiConfig.method });
                if (!response.ok) throw new Error('HTTP error');
                
                const data = await response.json();
                const processed = apiConfig.handler(data);
                
                if (processed !== null) return processed;
                if (retryCount < apiConfig.maxRetry) {
                    return fetchWithRetry(apiConfig, retryCount + 1);
                }
                throw new Error('超出最大重试次数');
            } catch (error) {
                if (retryCount < apiConfig.maxRetry) {
                    return fetchWithRetry(apiConfig, retryCount + 1);
                }
                throw error;
            }
        }

        function selectRandomAPI() {
            const totalWeight = apiConfigs.reduce((sum, api) => sum + api.weight, 0);
            let random = Math.random() * totalWeight;
            
            for (const api of apiConfigs) {
                if (random < api.weight) {
                    return api;
                }
                random -= api.weight;
            }
            return apiConfigs[0];
        }

        async function fetchGoldenPhrase() {
            if (Math.random() < apiProbability / 100) {
                try {
                    const selectedAPI = selectRandomAPI();
                    const text = await fetchWithRetry(selectedAPI);
                    updatePhraseDisplay(text);
                } catch (error) {
                    console.warn('金句API获取失败:', error);
                    showLocalPhrase();
                }
            } else {
                showLocalPhrase();
            }
        }

        function updatePhraseDisplay(text) {
            const container = document.getElementById('goldenPhrase');
            const animationEnabled = document.getElementById('animationSwitch').checked;
            const formattedText = text.replace(/\n/g, '<br>');
            if (animationEnabled) {
                container.style.opacity = 0;
                setTimeout(() => {
                    container.innerHTML = `「 ${formattedText} 」`;
                    container.style.opacity = 1;
                }, 500);
            } else {
                container.innerHTML = `「 ${formattedText} 」`;
                container.style.opacity = 1;
            }
        }

        // 动画开关事件监听
        document.getElementById('animationSwitch').addEventListener('change', function() {
            const goldenPhrase = document.getElementById('goldenPhrase');
            if (this.checked) {
                goldenPhrase.classList.remove('no-animation');
            } else {
                goldenPhrase.classList.add('no-animation');
            }
        });

        let lastPhrase = null;

        function showLocalPhrase() {
            const showOriginalOnly = document.getElementById('originalSwitch').checked;

            const filterOriginal = arr => showOriginalOnly ? 
                arr.filter(p => p.trim().endsWith('🌟')) : 
                arr;

            const filtered = {
                high: filterOriginal(localPhrases.high),
                medium: filterOriginal(localPhrases.medium),
                low: filterOriginal(localPhrases.low)
            };

            if (showOriginalOnly) {
                const allOriginal = [
                    ...filtered.high,
                    ...filtered.medium,
                    ...filtered.low
                ].filter(p => p !== lastPhrase);


                if (allOriginal.length === 0) {
                    const fallbackList = [
                        ...filtered.high,
                        ...filtered.medium,
                        ...filtered.low
                    ];
                    if (fallbackList.length === 0) {
                        return updatePhraseDisplay("🎯 没有原创金句");
                    }
                    const selected = fallbackList[Math.floor(Math.random() * fallbackList.length)];
                    lastPhrase = selected;
                    return updatePhraseDisplay(selected);
                }

                const selected = allOriginal[Math.floor(Math.random() * allOriginal.length)];
                lastPhrase = selected;
                return updatePhraseDisplay(selected);
            } else {
                const weights = {
                    high: filtered.high.length ? 45 : 0,
                    medium: filtered.medium.length ? 35 : 0,
                    low: filtered.low.length ? 20 : 0
                };

                const totalWeight = weights.high + weights.medium + weights.low;
                if(totalWeight === 0) return updatePhraseDisplay("🎯 没有找到金句");

                const buildPool = (list, weight) => {
                    if(!weight || !list.length) return [];
                    
                    const validList = list.filter(p => p !== lastPhrase);
                    const finalList = validList.length > 0 ? validList : list;
                    
                    return finalList.map(p => ({
                        p,
                        w: weight / finalList.length
                    }));
                };

                const pool = [
                    ...buildPool(filtered.high, weights.high),
                    ...buildPool(filtered.medium, weights.medium),
                    ...buildPool(filtered.low, weights.low)
                ];

                let random = Math.random() * totalWeight;
                let accumulated = 0;
                let selectedPhrase = pool[0]?.p || "🎲 金句加载中...";
                
                for(const item of pool) {
                    accumulated += item.w;
                    if(random <= accumulated) {
                        selectedPhrase = item.p;
                        break;
                    }
                }

                lastPhrase = selectedPhrase;
                return updatePhraseDisplay(selectedPhrase);
            }
        }

        // Part8 二十四节气时间轴
        // 生成节气标记 
        function generateSolarMarkers() {
            const springStart = solarTerms.find(t  => t.name  === '立春');
            const startDate = new Date(2025, springStart.month,  springStart.day); 
            const endDate = new Date(2025, 5, 18);
            const totalDays = (endDate - startDate) / 86400000;
            document.querySelectorAll('.solar-term-marker').forEach(m  => m.remove()); 
            solarTerms.forEach(term  => {
                const termDate = new Date(2025, term.month,  term.day); 
                if (termDate < startDate || termDate > endDate) return;
                const position = ((termDate - startDate) / 86400000 / totalDays) * 100;
                const isPast = termDate < new Date();
                const marker = document.createElement('div'); 
                marker.className  = 'solar-term-marker';
                marker.style.left  = `${position}%`;
                marker.innerHTML  = `
                    <div style="color: ${isPast ? '#666' : term.color}; 
                        font-weight: ${isPast ? 'normal' : '600'};
                        text-shadow: ${isPast ? 'none' : '0 2px 4px rgba(0,0,0,0.1)'}">
                        ${term.name} 
                    </div>
                    <div style="font-size:0.9em; color: ${isPast ? '#999' : '#666'};
                        margin-top: 5px">
                        ${termDate.getMonth()+1}  月${termDate.getDate()}  日 
                    </div>
                `;
                marker.addEventListener('mouseover',  () => {
                    if (!isPast) {
                        marker.style.transform  = 'translateX(-50%) scale(1.1)';
                        // marker.style.filter  = 'drop-shadow(0 4px 6px rgba(0,0,0,0.15))';
                    }
                });
                marker.addEventListener('mouseout',  () => {
                    marker.style.transform  = 'translateX(-50%) scale(1)';
                    marker.style.filter  = 'none';
                });
                timeline.appendChild(marker); 
                // 创建卡片
                const card = document.createElement('div');
                card.className = 'solar-card';
                card.innerHTML = `
                    <h3>${term.name}</h3>
                    <img src="${term.image}" alt="${term.name}">
                    <p>${term.desc}</p>
                `;
                marker.appendChild(card);
                // 点击事件处理
                marker.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const allCards = document.querySelectorAll('.solar-card');
                    allCards.forEach(c => c.classList.remove('active'));
                    card.classList.add('active');
                });
            });
            // 点击其他区域隐藏卡片
            document.addEventListener('click', () => {
                document.querySelectorAll('.solar-card').forEach(c => c.classList.remove('active'));
            });
        }

        // 时间轴
        function updateTimelineColor() {
            const springStart = solarTerms.find(t  => t.name  === '立春');
            const startDate = new Date(2025, springStart.month,  springStart.day); 
            const endDate = new Date(2025, 5, 18);
            const now = new Date();
            const total = endDate - startDate;
            const progress = Math.min(1,  Math.max(0,  (now - startDate) / total));
            timeline.style.setProperty('--progress-percent',  `${progress * 100}%`);
            requestAnimationFrame(updateTimelineColor);
        }

        // Part9 中考倒计时
        function updateCountdown() {
            const target = new Date(2025, 5, 18);
            const diff = target - new Date();
            const days = Math.max(0,  Math.ceil(diff  / 86400000));
            document.getElementById('daysUntil').textContent  = `${days}天`;

            const now = new Date();
            const msToNextDay = 86400000 - (now % 86400000);
            setTimeout(updateCountdown, msToNextDay);
        }

        // Part10 时钟显示
        function updateClock() {
            const date = new Date();
            const weekDays = ['日','一','二','三','四','五','六'];
            // 时间部分 
            const hh = date.getHours().toString().padStart(2,  '0');
            const mm = date.getMinutes().toString().padStart(2,  '0');
            const ss = date.getSeconds().toString().padStart(2,  '0');
            // 日期部分 
            const yyyy = date.getFullYear(); 
            const m = (date.getMonth()  + 1).toString().padStart(2, '0');
            const d = date.getDate().toString().padStart(2,  '0');
            const week = weekDays[date.getDay()];
            document.getElementById('currentDateTime').innerHTML  = `
                <div class="time-section">${hh}:${mm}:${ss}</div>
                <div class="date-section">${yyyy}/${m}/${d} 周${week}</div>
            `;
            requestAnimationFrame(updateClock);
        }

        function fetchAndDisplayImage(url) {
            fetch('https://api.cenguigui.cn/api/60s/')
                .then(response => response.blob()) 
                .then(blob => {
                    const img = document.getElementById('apiImage'); 
                    img.src  = URL.createObjectURL(blob); 
                    img.style.height  = '80vh';
                })
                .catch(error => console.error(' 图片加载失败:', error));
        }

        // Part11 金句自动轮播和显示每日60s开关
        // 初始化开关状态
        const goldenSwitch = document.getElementById('goldenSwitch'); 
        const imageSwitch = document.getElementById('imageSwitch'); 
        const apiImage = document.getElementById('apiImage'); 

        // 金句自动轮播开关
        goldenSwitch.addEventListener('change', function() {
            if (this.checked) {
                phraseTimer = setInterval(fetchGoldenPhrase, intervalDuration);
            } else {
                clearInterval(phraseTimer);
                phraseTimer = null;
            }
        });

        // 显示每日60s开关
        imageSwitch.addEventListener('change',  function() {
            if (this.checked)  {
                apiImage.style.display  = 'block';
                fetchAndDisplayImage();
                setInterval(fetchAndDisplayImage, 86400000);
            } else {
                apiImage.style.display  = 'none';
                clearInterval(imageUpdateInterval);
            }
        });

        // 初始化时设置默认状态
        goldenSwitch.checked  = true; // 默认开启金句自动轮播
        imageSwitch.checked  = true; // 默认开启每日60s显示

        // Part12 天气
        function fetchWeather() {
            fetch('https://v2.api-m.com/api/weather?city=%E5%B2%B3%E9%BA%93%E5%8C%BA')
                .then(response => {
                    if (!response.ok) throw new Error('网络响应异常');
                    return response.json();
                })
                .then(data => {
                if (data.code === 200) {
                    // 获取当前星期（示例返回格式："周五"）
                    const weekDays = ['日', '一', '二', '三', '四', '五', '六'];
                    const currentDay = '周' + weekDays[new Date().getDay()];
                    // 查找匹配的天气数据
                    const todayWeather = data.data.data.find(item => item.date === currentDay);
                    if (todayWeather) {
                        // 格式化温度显示（7-10℃ → 7~10℃）
                        const tempRange = todayWeather.temperature.replace('-', '~');
                        document.getElementById('weatherInfo').textContent = 
                        `${todayWeather.weather} ${tempRange}`;
                    } else {
                        document.getElementById('weatherInfo').textContent = '天气数据异常';
                    }
                } else {
                    throw new Error(data.msg);
                }
                })
            .catch(error => {
                console.error('天气获取失败:', error);
                document.getElementById('weatherInfo').textContent = '天气获取失败';
            });
        }

        window.onload  = function() {
            fetchAndDisplayImage();
        };

        // Part13 点击刷新金句功能
        document.getElementById('goldenPhrase').addEventListener('click', function() {
            const clickRefreshEnabled = document.getElementById('clickRefreshSwitch').checked;
            const autoRotateEnabled = document.getElementById('goldenSwitch').checked;
            const animationEnabled = document.getElementById('animationSwitch').checked;
            
            if (clickRefreshEnabled) {
                // 当动画关闭时直接显示新内容
                if (!animationEnabled) {
                    fetchGoldenPhrase();
                    return;
                }
                // 保留原有缩放动画
                this.style.transform = 'scale(0.98)';
                setTimeout(() => {
                    this.style.transform = 'scale(1)';
                    fetchGoldenPhrase();
                }, 300);
                if (autoRotateEnabled && phraseTimer) {
                    clearInterval(phraseTimer);
                    phraseTimer = setInterval(fetchGoldenPhrase, intervalDuration);
                }
            }
        });

        // Part14 金句选择功能
        const phraseModal = document.getElementById('phraseModal');
        const closePhrase = document.getElementById('closePhrase');
        const phraseButton = document.getElementById('phraseSelectButton'); 

        // 打开金句选择
        function populatePhraseList() {
            const allPhrases = [...localPhrases.high, ...localPhrases.medium, ...localPhrases.low];
            const phraseList = document.getElementById('phraseList');
            phraseList.innerHTML = '';
            const fragment = document.createDocumentFragment();
            allPhrases.forEach(phrase => {
                const div = document.createElement('div');
                div.className = 'phrase-item';
                div.innerHTML = phrase.replace(/\n/g, '<br>');
                div.addEventListener('click', function() {
                    this.classList.add('phrase-click-effect');
                    setTimeout(() => {
                        this.classList.remove('phrase-click-effect');
                    }, 400);
                    updatePhraseDisplay(phrase);
                    setTimeout(() => {
                        phraseModal.classList.remove('active');
                    }, 200);
                    if (goldenSwitch.checked) {
                        clearInterval(phraseTimer);
                        phraseTimer = setInterval(fetchGoldenPhrase, intervalDuration);
                    }
                });
                fragment.appendChild(div);
            });
            phraseList.appendChild(fragment);
        }

        // 修改打开模态框事件
        phraseButton.addEventListener('click', () => {
            populatePhraseList();
            phraseModal.classList.add('active');
        });

        // 关闭金句选择
        closePhrase.addEventListener('click', () => {
            phraseModal.classList.remove('active');
        });

        // Part15 寻物功能
        const lostAndFoundButton = document.getElementById('lostAndFoundButton');
        const lostAndFoundModal = document.getElementById('lostAndFoundModal');
        const closeLostAndFound = document.getElementById('closeLostAndFound');

        // 打开寻物板
        lostAndFoundButton.addEventListener('click', () => {
            lostAndFoundModal.classList.add('active');
        });

        // 关闭寻物板
        closeLostAndFound.addEventListener('click', () => {
            lostAndFoundModal.classList.remove('active');
        });

        // 编辑功能
        document.getElementById('lostAndFoundList').addEventListener('click', function(e) {
            const target = e.target;
            if (target.classList.contains('editable')) {
                const originalText = target.textContent;
                const input = document.createElement('input');
                input.className = 'edit-input';
                input.value = originalText;
                input.style.width = target.offsetWidth + 'px';
                
                input.addEventListener('blur', function() {
                    target.textContent = this.value;
                    target.style.display = 'inline';
                    input.remove();
                });

                input.addEventListener('input', function() {
                    this.style.width = (this.value.length * 20 + 30) + 'px';
                });

                target.style.display = 'none';
                target.parentNode.insertBefore(input, target);
                input.focus();
            }
        });

        // 添加卡片功能
        document.querySelector('.add-button').addEventListener('click', () => {
            const newCard = document.createElement('div');
            newCard.className = 'announcement-card';
            newCard.innerHTML = `
                <div class="announcement-body" style="position:relative; text-align: center; font-family: STZhongsong, serif;">
                    <span class="editable" data-type="name" style="color: #1E90FF;">同学</span>
                    <span class="static-text">的</span> <!-- 移除了颜色样式，使用默认黑色 -->
                    <span class="editable" data-type="item" style="color: #1E90FF;">物品</span>
                    <button class="delete-btn">删除</button>
                </div>
            `;
            document.getElementById('lostAndFoundList').appendChild(newCard);
            
            // 立即应用当前字体大小
            const editables = newCard.querySelectorAll('.editable, .static-text');
            editables.forEach(item => {
                item.style.fontSize = `${lostAndFoundFontSize}px`;
            });
        });

        // 删除功能（使用事件委托）
        document.getElementById('lostAndFoundList').addEventListener('click', function(e) {
            if (e.target.classList.contains('delete-btn')) {
                if (e.target.textContent === '删除') {
                    e.target.textContent = '确认删除';
                    e.target.style.background = '#d32f2f';
                } else {
                    e.target.closest('.announcement-card').remove();
                }
            }
        });

        // 重置删除按钮状态（当点击其他地方时）
        document.addEventListener('click', (e) => {
            if (!e.target.classList.contains('delete-btn')) {
                document.querySelectorAll('.delete-btn').forEach(btn => {
                    btn.textContent = '删除';
                    btn.style.background = '#ff4444';
                });
            }
        });

        let lostAndFoundFontSize = 28;
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化通知板
            renderNotifications();
            
            // 初始化寻物板字体大小控制
            const lostAndFoundFontSizeSlider = document.getElementById('lostAndFoundFontSizeSlider');
            const lostAndFoundFontSizeValue = document.getElementById('lostAndFoundFontSizeValue');
            
            if (lostAndFoundFontSizeSlider && lostAndFoundFontSizeValue) {
                // 滑块事件
                lostAndFoundFontSizeSlider.addEventListener('input', function() {
                    const size = parseInt(this.value);
                    updateLostAndFoundFontSize(size);
                });

                // 输入框事件
                lostAndFoundFontSizeValue.addEventListener('input', function() {
                    let value = parseInt(this.value) || 28;
                    if (value < 12) value = 12;
                    if (value > 120) value = 120;
                    updateLostAndFoundFontSize(value);
                });
                
                // 初始化字体大小
                updateLostAndFoundFontSize(28);
            }
        });

        // 更新寻物板字体大小的函数
        function updateLostAndFoundFontSize(size) {
            lostAndFoundFontSize = size;
            if (document.getElementById('lostAndFoundFontSizeSlider')) {
                document.getElementById('lostAndFoundFontSizeSlider').value = size;
            }
            if (document.getElementById('lostAndFoundFontSizeValue')) {
                document.getElementById('lostAndFoundFontSizeValue').value = size;
            }
            
            // 应用字体大小到所有寻物条目
            const items = document.querySelectorAll('#lostAndFoundList .editable, #lostAndFoundList .static-text');
            items.forEach(item => {
                item.style.fontSize = `${size}px`;
            });
        }

        // Part16 通知功能
        const notificationButton = document.getElementById('notificationButton');
        const notificationModal = document.getElementById('notificationModal');
        const closeNotification = document.getElementById('closeNotification');
        const notificationContent = document.getElementById('notificationContent');
        const addNotificationBtn = document.getElementById('addNotificationBtn');
        const fontSizeSlider = document.getElementById('fontSizeSlider');
        const fontSizeValue = document.getElementById('fontSizeValue');
        
        // 通知数据 - 初始为空数组
        let notifications = [];
        
        // 打开通知模态框
        notificationButton.addEventListener('click', () => {
            notificationModal.classList.add('active');
            renderNotifications();
        });
        
        // 关闭通知模态框
        closeNotification.addEventListener('click', () => {
            notificationModal.classList.remove('active');
        });
        
        // 动态调整textarea高度
        function adjustTextareaHeight(textarea) {
            // 设置最小高度为100px
            const minHeight = 100;
            textarea.style.height = 'auto';
            const height = Math.max(minHeight, textarea.scrollHeight);
            textarea.style.height = height + 'px';
        }
        
        // 渲染通知
        function renderNotifications() {
            notificationContent.innerHTML = '';
            
            if (notifications.length === 0) {
                notificationContent.innerHTML = '<div class="empty-notification">暂无通知，点击下方按钮添加</div>';
                return;
            }
            
            const currentFontSize = notificationContent.style.fontSize || '16px';
            
            notifications.forEach((text, index) => {
                const item = document.createElement('div');
                item.className = 'notification-item';
                item.dataset.index = index;
                const formattedText = text.replace(/\n/g, '<br>');
                item.innerHTML = formattedText;
                item.style.fontSize = currentFontSize;
                
                // 添加删除按钮
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'delete-notification-btn';
                deleteBtn.textContent = '删除';
                deleteBtn.dataset.index = index;
                item.appendChild(deleteBtn);
                
                // 删除按钮事件 - 修复事件冒泡问题
                deleteBtn.addEventListener('click', function(e) {
                    e.stopPropagation(); // 阻止事件冒泡
                    const index = this.dataset.index;
                    
                    if (this.textContent === '删除') {
                        this.textContent = '确认删除';
                        this.style.background = '#d32f2f';
                    } else {
                        notifications.splice(index, 1);
                        renderNotifications();
                    }
                });
                
                // 点击通知进入编辑模式
                item.addEventListener('click', function(e) {
                    // 如果点击的是删除按钮则不进入编辑
                    if (e.target.classList.contains('delete-notification-btn')) return;
                    
                    const index = this.dataset.index;
                    const textarea = document.createElement('textarea');
                    textarea.className = 'notification-editable';
                    textarea.value = notifications[index];
                    textarea.style.fontSize = currentFontSize;
                    
                    // 初始高度调整
                    adjustTextareaHeight(textarea);
                    
                    this.innerHTML = '';
                    this.appendChild(textarea);
                    textarea.focus();
                    
                    // 输入时动态调整高度
                    textarea.addEventListener('input', function() {
                        adjustTextareaHeight(this);
                    });
                    
                    // 修复：添加对Enter键的处理
                    textarea.addEventListener('keydown', function(e) {
                        if (e.key === 'Enter' && !e.shiftKey) {
                            e.preventDefault();
                            // 在光标位置插入换行符
                            const start = this.selectionStart;
                            const end = this.selectionEnd;
                            this.value = this.value.substring(0, start) + '\n' + this.value.substring(end);
                            this.selectionStart = this.selectionEnd = start + 1;
                            adjustTextareaHeight(this);
                        }
                    });
                    
                    textarea.addEventListener('blur', function() {
                        notifications[index] = this.value;
                        renderNotifications();
                    });
                });
                
                notificationContent.appendChild(item);
            });
        }
        
        // 添加新通知
        addNotificationBtn.addEventListener('click', () => {
            notifications.push("新通知 - 点击编辑内容");
            renderNotifications();
            
            // 滚动到底部
            notificationContent.scrollTop = notificationContent.scrollHeight;
        });
        
        // 字体大小控制
        fontSizeSlider.addEventListener('input', function() {
            const size = this.value + 'px';
            notificationContent.style.fontSize = size;
            fontSizeValue.value = this.value;
            renderNotifications();
        });
        
        fontSizeValue.addEventListener('input', function() {
            let value = parseInt(this.value) || 16;
            if (value < 12) value = 12;
            if (value > 120) value = 120;
            
            notificationContent.style.fontSize = value + 'px';
            fontSizeSlider.value = value;
            this.value = value;
            renderNotifications();
        });

        // 点击模态框外部时重置所有删除按钮
        document.addEventListener('click', (e) => {
            if (!e.target.classList.contains('delete-notification-btn')) {
                document.querySelectorAll('.delete-notification-btn').forEach(btn => {
                    btn.textContent = '删除';
                    btn.style.background = '#ff4444';
                });
            }
        });

        // 初始化通知
        document.addEventListener('DOMContentLoaded', () => {
            renderNotifications();
        });

        // Part17 窗口最大化
        // 通知模态框最大化功能
        const maximizeNotification = document.getElementById('maximizeNotification');
        maximizeNotification.addEventListener('click', function() {
            const modal = document.getElementById('notificationModal');
            const content = modal.querySelector('.settings-content');
            
            if (modal.classList.contains('fullscreen')) {
                modal.classList.remove('fullscreen');
                this.textContent = '⛶';
            } else {
                modal.classList.add('fullscreen');
                this.textContent = '🗗';
            }
        });

        // 寻物模态框最大化功能
        const maximizeLostAndFound = document.getElementById('maximizeLostAndFound');
        maximizeLostAndFound.addEventListener('click', function() {
            const modal = document.getElementById('lostAndFoundModal');
            const content = modal.querySelector('.settings-content');
            
            if (modal.classList.contains('fullscreen')) {
                modal.classList.remove('fullscreen');
                this.textContent = '⛶';
            } else {
                modal.classList.add('fullscreen');
                this.textContent = '🗗';
            }
        });

        // 关闭模态框时重置全屏状态
        function resetFullscreen(modalId) {
            const modal = document.getElementById(modalId);
            if (modal.classList.contains('fullscreen')) {
                modal.classList.remove('fullscreen');
                const maximizeBtn = modal.querySelector('.maximize-btn');
                if (maximizeBtn) maximizeBtn.textContent = '⛶';
            }
        }

        // 在关闭通知模态框时调用重置
        closeNotification.addEventListener('click', () => {
            resetFullscreen('notificationModal');
            notificationModal.classList.remove('active');
        });

        // 在关闭寻物模态框时调用重置
        closeLostAndFound.addEventListener('click', () => {
            resetFullscreen('lostAndFoundModal');
            lostAndFoundModal.classList.remove('active');
        });

        // Part18 自动刷新
        // 获取自动刷新开关元素
        const autoRefreshSwitch = document.getElementById('autoRefreshSwitch');
        let refreshTimer = null; // 刷新定时器
        const REFRESH_INTERVAL = 15 * 60 * 1000; // 15分钟（毫秒）

        // 启动自动刷新
        function startAutoRefresh() {
            // 清除现有定时器
            if (refreshTimer) clearTimeout(refreshTimer);
            
            // 设置新定时器
            refreshTimer = setTimeout(() => {
                location.reload();
            }, REFRESH_INTERVAL);
        }

        // 停止自动刷新
        function stopAutoRefresh() {
            if (refreshTimer) {
                clearTimeout(refreshTimer);
                refreshTimer = null;
            }
        }

        // 监听开关变化
        autoRefreshSwitch.addEventListener('change', function() {
            if (this.checked) {
                startAutoRefresh();
            } else {
                stopAutoRefresh();
            }
        });

        // 页面加载时默认开启自动刷新
        window.addEventListener('DOMContentLoaded', () => {
            // 默认开启开关
            autoRefreshSwitch.checked = true;
            // 启动自动刷新
            startAutoRefresh();
        });

        // 在页面卸载时清除定时器
        window.addEventListener('beforeunload', () => {
            if (refreshTimer) {
                clearTimeout(refreshTimer);
            }
        });

        // PartLast 初始化 
        function init() {
            // 检测是否已经过了中考时间
            const examEndTime = new Date(2025, 5, 20, 10, 40); // 2025年6月20日10:40
            const now = new Date();
            
            if (now >= examEndTime) {
                // 修改标题
                document.querySelector('.small-title').textContent = '三年寒窗';
                
                // 修改天数显示
                const daysElement = document.getElementById('daysUntil');
                daysElement.textContent = '我们毕业啦';
                daysElement.style.fontFamily = 'Ximai, STKaiti';
                daysElement.style.fontSize = '120px'; // 适当调整大小
                daysElement.style.color = '#d32f2f'; // 喜庆的红色
                daysElement.style.textShadow = '2px 2px 4px rgba(0,0,0,0.2)';
                
                // 修改金句显示为毕业相关
                updatePhraseDisplay("🎓 毕业快乐！愿我们前程似锦，未来可期！");
                return;
            }
            updateCountdown();
            updateClock();
            updateTimelineColor();
            generateSolarMarkers();
            fetchGoldenPhrase();
            phraseTimer = setInterval(fetchGoldenPhrase, intervalDuration);
            setInterval(updateScheduleDisplay, 1000);
            fetchWeather();
            setInterval(fetchWeather, 15000);
            updateCountdownDisplay();
        }

        init();

        window.addEventListener('unload',  () => clearInterval(phraseTimer));
        setInterval(() => {
            generateSolarMarkers();
            updateCountdown();
        }, 86400000);
    </script>



</body>
</html>
